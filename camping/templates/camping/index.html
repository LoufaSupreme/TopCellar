{% extends "camping/layout.html" %}

{% block body %}
<div class="dropdowns">
    <form method="GET">
        <div class="single-dd-container">
            <label for='res-loc-dd'>Location:</label>
            <select id="loc-select" name='res-loc-dd' onchange='numResults();' multiple>
                {% for resloc in dd_opt.resource_locations.all %}
                <option value='{{ resloc.full_name }}'>{{ resloc.full_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="single-dd-container">
            <label for='res-cat-dd'>Category:</label>
            <select id="cat-select" name='res-cat-dd' onchange='numResults();' multiple>
                <!-- <option value='all'>All</option> -->
                {% for rescat in dd_opt.resource_categories.all %}
                <option value='{{ rescat.name }}'>{{ rescat.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="single-dd-container">
            <label for='equip-dd'>Equipment:</label>
            <select id="equip-select" name='equip-dd' onchange='numResults();' multiple>
                <!-- <option value='all'>All</option> -->
                {% for equip in dd_opt.equipment.all %}
                <option value='{{ equip.name }}'>{{ equip.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="single-dd-container">
            <label for='attr-dd'>Features:</label>
            <select id="attr-select" name='attr-dd' onchange='numResults();'>
                <option value='all'>All</option>
                {% for attr in dd_opt.attributes.all %}
                <option value='{{ attr.main_name }}'>{{ attr.main_name }}</option>
                {% endfor %}
            </select>
        </div>
        <input type="submit" value='submit' id='submit-btn'/>
    </form>
    <div id="num-results">{{ num_results }} matching sites.</div>
</div>

<div class="site-section">
    {% for site in page_obj %}
    <div class='site-container' data-res-loc='{{ site.resource_location.resource_location_id }}' data-map-id='{{ site.camp_map.map_id }}' data-res-id='{{ site.resource_id }}'>
        <div class='attribute-container'>
            <div class='header'><span>Site Info</span></div>
            <div class='content'>
                <div class='attr-box' id='site-num'>{{ site.name }}</div>
                <div class='attr-box' id='park-name'>{{ site.resource_location.full_name }}</div>
                <div class='attr-box' id='res-id'> {{ site.resource_id }}</div>
            </div>
        </div>

        <div class='attribute-container'>
            <div class='header'><span>Key Attributes:</span></div>
            <div class='content'>
                {% if site.site_attributes.count > 0 %}
                {% for attr in site.site_attributes.all %}
                    <div class='attr-box'>
                        <span>{{ attr.attribute.main_name }}:</span>
                        <span>{{ attr.value }}</span>
                    </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>

        <div class='attribute-container'>
            <div class='header'><span>Allowed Equipment:</span></div>
            <div class='content'>
                {% if site.allowed_equipment.count > 0 %}
                {% for equip in site.allowed_equipment.all %}
                <div class='attr-box'>
                    <span>{{ equip.name }}</span>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>

        <div class='attribute-container'>
            <div class='header'><span>Other Info:</span></div>
            <div class='content'>
                <div class='attr-box'>
                    <span>Max Capacity:</span>
                    <span>{{ site.max_capacity }}</span>
                </div>
                <div class='attr-box'>
                    <span>Resource Category:</span>
                    <span>{{ site.resource_category.name }}</span>
                </div>
            </div>
        </div>

        <div class='attribute-container'>
            <div class='header'><span>Availability:</span></div>
            <div class='content'>
                <div class='attr-box' id='{{ site.resource_id }}-availability-list'></div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="paginator-section">
    <span class="current-page">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>
    <nav aria-label="Page navigation">
        <ul class="pagination">
        <li class="page-item">
            {% if page_obj.has_previous %}
                <a class="page-link" href="?{% if query %}{{ query }}&{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Previous">
                    <section aria-hidden="true">&laquo;</section>
                </a>
            {% endif %}
        </li>
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active"><a class="page-link" href="?{% if query %}{{ query }}&{% endif %}page={{ num }}">{{ num }}</a></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item "><a class="page-link" href="?{% if query %}{{ query }}&{% endif %}page={{ num }}">{{ num }}</a></li>
            {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% if query %}{{ query }}&{% endif %}page={{ page_obj.next_page_number }}" aria-label="Next">
                <section aria-hidden="true">&raquo;</section>
                </a>
            </li>
        {% endif %}
        </ul> 
    </nav>
</div> 

<script>
    addAvailability({{ loc_id_list }}, {{ map_id_list }});
</script>

{% endblock %}